-- int_aktive_alder
-- Viser alle som har en l√∏pende alderspensjonsytelse

with

ref_int_aktive_alder_kap20 as (
    select
        sak_id,
        vedtak_id,
        kravhode_id,
        grein,
        k_afp_t,
        regelverk,
        dato_virk_tom,
        dato_virk_fom,
        beregning_id,
        beregning_info_id,
        beregning_info_id_2016,
        beregning_info_id_2025,
        beregning_info_id_avdod,
        beregning_info_id_avdod_2016,
        pen_under_utbet_id,
        uttaksgrad,
        brutto,
        netto,
        gp_netto,
        tp_netto,
        pt_netto,
        st_netto,
        et_netto,
        ip_netto,
        gap_netto,
        gjt_netto,
        gjt_k19_netto,
        skjermt_netto,
        saerkull_netto,
        mpn_sstot_netto,
        mpn_indiv_netto,
        barn_felles_netto,
        ufor_sum_ut_ord_netto,
        ap_kap19_uten_gjr_bel,
        ap_kap19_med_gjr_bel,
        minstepensjonist,
        minste_pen_niva,
        afp_lopph_flagg,
        afp_finans_flagg,
        afp_lopph_ytelse_flagg,
        red_pga_inst_opph_flagg,
        anvendt_yrkesskade_flagg
    from {{ ref('int_aktive_alder_kap20') }}
),

ref_int_aktive_alder_kap19 as (
    select
        sak_id,
        vedtak_id,
        kravhode_id,
        grein,
        k_afp_t,
        regelverk,
        dato_virk_tom,
        dato_virk_fom,
        beregning_id,
        beregning_info_id,
        beregning_info_id_2016,
        beregning_info_id_2025,
        beregning_info_id_avdod,
        beregning_info_id_avdod_2016,
        pen_under_utbet_id,
        uttaksgrad,
        brutto,
        netto,
        gp_netto,
        tp_netto,
        pt_netto,
        st_netto,
        et_netto,
        ip_netto,
        gap_netto,
        gjt_netto,
        gjt_k19_netto,
        skjermt_netto,
        saerkull_netto,
        mpn_sstot_netto,
        mpn_indiv_netto,
        barn_felles_netto,
        ufor_sum_ut_ord_netto,
        ap_kap19_uten_gjr_bel,
        ap_kap19_med_gjr_bel,
        minstepensjonist,
        minste_pen_niva,
        afp_lopph_flagg,
        afp_finans_flagg,
        afp_lopph_ytelse_flagg,
        red_pga_inst_opph_flagg,
        anvendt_yrkesskade_flagg
    from {{ ref('int_aktive_alder_kap19') }}
),

union_kap_19_20 as (
    select * from ref_int_aktive_alder_kap19
    union all
    select * from ref_int_aktive_alder_kap20
),

final as (
    select
        sak_id,
        vedtak_id,
        kravhode_id,
        grein,
        k_afp_t,
        regelverk,
        dato_virk_tom,
        dato_virk_fom,
        beregning_id,
        beregning_info_id,
        beregning_info_id_2016,
        beregning_info_id_2025,
        beregning_info_id_avdod,
        beregning_info_id_avdod_2016,
        pen_under_utbet_id,
        uttaksgrad,
        brutto,
        netto,
        gp_netto,
        tp_netto,
        pt_netto,
        st_netto,
        et_netto,
        ip_netto,
        gap_netto,
        gjt_netto,
        gjt_k19_netto,
        skjermt_netto,
        saerkull_netto,
        mpn_sstot_netto,
        mpn_indiv_netto,
        barn_felles_netto,
        ufor_sum_ut_ord_netto,
        ap_kap19_uten_gjr_bel,
        ap_kap19_med_gjr_bel,
        minstepensjonist,
        minste_pen_niva,
        afp_lopph_flagg,
        afp_finans_flagg,
        afp_lopph_ytelse_flagg,
        red_pga_inst_opph_flagg,
        anvendt_yrkesskade_flagg
    from union_kap_19_20
)

select * from final
